# 🤖 和風牌監視器 - Discord Bot 使用說明

一款功能豐富的 Discord 機器人，提供語音時數追蹤、匯率查詢、天氣預報和晚餐抽獎等實用功能。

> 🤖 **本專案全程由 AI 生成** — 使用 GitHub Copilot 輔助開發

---

## 📋 目錄

- [快速開始](#-快速開始)
- [功能總覽](#-功能總覽)
- [指令說明](#-指令說明)
  - [語音時數追蹤](#-語音時數追蹤)
  - [匯率查詢](#-匯率查詢)
  - [天氣預報](#️-天氣預報)
  - [晚餐抽獎](#-晚餐抽獎)
  - [管理員指令](#-管理員指令)
- [功能選單](#-功能選單)
- [安裝與設定](#️-安裝與設定)

---

## 🚀 快速開始

### 開啟功能選單
在伺服器中 **@提及機器人**，即可開啟互動式功能選單，快速存取所有功能！

### 使用斜線指令
直接輸入 `/` 開頭的指令來使用各項功能。

---

## ✨ 功能總覽

| 功能 | 指令 | 說明 |
|------|------|------|
| 🎙️ 語音時數 | `/time` | 查看本週語音排行榜 |
| 💱 匯率查詢 | `/money` | 查詢即時匯率與走勢圖 |
| 🌤️ 天氣預報 | `/weather` | 查詢臺灣各縣市天氣 |
| 🍽️ 晚餐抽獎 | `/dinner` | 隨機抽選今晚吃什麼 |

---

## 📖 指令說明

### 🎙️ 語音時數追蹤

機器人會自動記錄成員在語音頻道的時間，並提供多種排行榜查詢。

| 指令 | 說明 |
|------|------|
| `/time` | 查看 **本週** 語音排行榜（週一 00:00 起） |
| `/timemonth` | 查看 **本月** 語音排行榜（每月 1 日起） |
| `/timeyear` | 查看 **本年** 語音排行榜（每年 1/1 起） |
| `/timeall` | 查看 **累積** 語音排行榜（歷史總計） |

#### 使用方式
```
/time
/time @成員名稱    ← 查詢指定成員的排名
```

#### 功能特色
- ✅ 自動追蹤語音頻道時間
- ✅ 每分鐘同步更新數據
- ✅ 週期自動重置（週/月/年）
- ✅ 顯示前 10 名排行

---

### 💱 匯率查詢

查詢各國貨幣對新台幣 (TWD) 的即時匯率與歷史走勢。

| 指令 | 說明 |
|------|------|
| `/money` | 開啟匯率查詢選單 |

#### 支援貨幣

**常用貨幣**
| 代碼 | 貨幣 |
|------|------|
| 🇺🇸 USD | 美元 |
| 🇯🇵 JPY | 日圓 |
| 🇪🇺 EUR | 歐元 |
| 🇨🇳 CNY | 人民幣 |

**亞洲貨幣**
| 代碼 | 貨幣 |
|------|------|
| 🇭🇰 HKD | 港幣 |
| 🇰🇷 KRW | 韓元 |
| 🇸🇬 SGD | 新加坡幣 |
| 🇹🇭 THB | 泰銖 |
| 🇻🇳 VND | 越南盾 |
| 🇲🇾 MYR | 馬來幣 |
| 🇵🇭 PHP | 菲律賓披索 |
| 🇮🇩 IDR | 印尼盾 |

**歐美貨幣**
| 代碼 | 貨幣 |
|------|------|
| 🇬🇧 GBP | 英鎊 |
| 🇦🇺 AUD | 澳幣 |
| 🇨🇦 CAD | 加幣 |
| 🇨🇭 CHF | 瑞士法郎 |

#### 功能特色
- ✅ 即時匯率查詢
- ✅ 90 天歷史走勢圖
- ✅ 快速金額換算（100/500/1000/5000/10000）
- ✅ 漲跌趨勢分析
- ✅ 5 分鐘資料快取

---

### 🌤️ 天氣預報

查詢臺灣各縣市的即時天氣與未來 24 小時預報。

| 指令 | 說明 |
|------|------|
| `/weather 縣市名稱` | 查詢指定縣市天氣 |

#### 使用範例
```
/weather 臺北市
/weather 高雄市
/weather 台中市    ← 支援「台」或「臺」
```

#### 支援地區

**北部**
- 臺北市、新北市、基隆市、桃園市
- 新竹市、新竹縣、宜蘭縣

**中部**
- 臺中市、苗栗縣、彰化縣、南投縣、雲林縣

**南部**
- 臺南市、高雄市、嘉義市、嘉義縣、屏東縣

**東部及離島**
- 花蓮縣、臺東縣、澎湖縣、金門縣、連江縣

#### 提供資訊
- 🌡️ 即時溫度
- 🤒 體感溫度
- 💧 濕度
- 🌧️ 降雨機率
- 💨 風速
- 👔 穿衣建議
- ⏰ 逐 3 小時預報（未來 24 小時）

#### 資料來源
📡 中央氣象署開放資料平台

---

### 🍽️ 晚餐抽獎

不知道今天晚餐吃什麼？讓命運來決定！

| 指令 | 說明 |
|------|------|
| `/dinner` | 開啟晚餐抽獎選單 |

#### 料理類型

| 類型 | 說明 |
|------|------|
| 🍚 飯類 | 便當、燒臘、咖哩飯等 |
| 🍜 麵類 | 牛肉麵、拉麵、義大利麵等 |
| 🍢 小吃 | 鹹酥雞、滷味、水餃等 |
| 🍲 鍋物 | 火鍋、麻辣鍋、薑母鴨等 |
| 🇰🇷 韓式 | 韓式炸雞、石鍋拌飯等 |
| 🇯🇵 日式 | 壽司、丼飯、拉麵等 |
| 🇭🇰 港式 | 港式燒臘、茶餐廳料理等 |
| 🎲 隨便來 | 完全隨機，交給命運！ |

#### 抽獎結果包含
- 🍽️ 隨機抽選的料理
- 🥤 推薦飲料搭配
- 🍴 加點推薦
- 💡 用餐小提示
- ⭐ 今日運勢

---

### 🔧 管理員指令

以下指令僅限維護員（`MAINTAINER_ID`）使用：

| 指令 | 說明 |
|------|------|
| `/timeclean` | 清除本伺服器所有語音統計資料 |
| `/sync` | 同步斜線指令到此伺服器（立即生效） |

---

## 🎛️ 功能選單

除了使用斜線指令，你也可以透過 **@提及機器人** 來開啟互動式功能選單：

1. 在聊天頻道輸入 `@機器人名稱` 或直接提及機器人
2. 機器人會回覆一個功能選單
3. 點擊按鈕選擇想使用的功能：
   - 🎙️ **語音時數** - 查看語音排行榜（週榜/月榜/年榜/總榜）
   - 💱 **匯率看板** - 查詢即時匯率
   - 🍽️ **晚餐抽獎** - 抽選今晚吃什麼
   - 🌤️ **天氣預報** - 查詢縣市天氣

> ⏰ 選單會在 2-3 分鐘後自動失效

---

## 🛠️ 安裝與設定

### 環境需求

| 項目 | 版本需求 | 說明 |
|------|----------|------|
| 🐍 **Python** | `3.9` 以上 | 建議使用 Python 3.10 或 3.11 |
| 💻 **作業系統** | Windows / macOS / Linux | 皆可運行 |
| 🔑 **Discord Bot Token** | - | 需從 Discord Developer Portal 取得 |
| 🌤️ **中央氣象署 API Key** | - | 天氣功能需要（選用） |

### 相依套件

專案使用以下 Python 套件，所有套件皆可透過 `pip install -r requirements.txt` 一次安裝：

| 套件名稱 | 版本 | 用途 |
|----------|------|------|
| **discord.py** | `2.3.2` | Discord Bot 核心框架，提供斜線指令、UI 元件等功能 |
| **aiosqlite** | `0.19.0` | 非同步 SQLite 資料庫操作，用於語音時數追蹤 |
| **python-dotenv** | `1.0.0` | 讀取 `.env` 環境變數檔案 |
| **httpx** | `0.26.0` | 非同步 HTTP 客戶端，用於 API 請求（匯率、天氣） |
| **certifi** | `≥2024.2.0` | SSL 憑證驗證，確保 HTTPS 請求安全 |

### 版本相容性

```
Python 版本支援：
├── ✅ Python 3.9  （最低支援版本）
├── ✅ Python 3.10 （推薦）
├── ✅ Python 3.11 （推薦）
├── ✅ Python 3.12 （支援）
└── ❌ Python 3.8  （不支援，缺少必要功能）

作業系統支援：
├── ✅ Windows 10/11
├── ✅ macOS 10.15+
├── ✅ Ubuntu 20.04+
└── ✅ 其他 Linux 發行版
```

### 安裝步驟

1. **確認 Python 版本**
   ```bash
   python --version
   # 需要 Python 3.9 或以上
   ```

2. **複製專案**
   ```bash
   git clone https://github.com/你的帳號/你的專案.git
   cd 你的專案
   ```

3. **建立虛擬環境（建議）**
   ```bash
   # Windows
   python -m venv venv
   venv\Scripts\activate

   # macOS / Linux
   python3 -m venv venv
   source venv/bin/activate
   ```

4. **安裝相依套件**
   ```bash
   pip install -r requirements.txt
   ```

5. **設定環境變數**
   
   建立 `.env` 檔案（複製範例）：
   ```bash
   # Windows
   copy .env.example .env

   # macOS / Linux
   cp .env.example .env
   ```
   
   編輯 `.env` 檔案內容：
   ```env
   # 必填 - Discord 機器人 Token
   DISCORD_TOKEN=你的機器人Token

   # 選填 - 時區設定（預設：UTC）
   BOT_TIMEZONE=Asia/Taipei

   # 選填 - 維護員 Discord 用戶 ID
   MAINTAINER_ID=你的Discord用戶ID

   # 選填 - 中央氣象署 API Key（天氣功能需要）
   CWA_API_KEY=你的氣象署API金鑰
   ```

6. **啟動機器人**
   ```bash
   python bot.py
   ```

### 環境變數說明

| 變數 | 必填 | 說明 |
|------|------|------|
| `DISCORD_TOKEN` | ✅ | Discord 機器人 Token，從 [Discord Developer Portal](https://discord.com/developers/applications) 取得 |
| `BOT_TIMEZONE` | ❌ | 時區設定（預設：`UTC`），台灣使用 `Asia/Taipei` |
| `MAINTAINER_ID` | ❌ | 維護員的 Discord 用戶 ID，擁有管理員指令權限 |
| `CWA_API_KEY` | ❌ | [中央氣象署開放資料平台](https://opendata.cwa.gov.tw/) API 授權碼，天氣功能需要 |

### 快速檢查安裝

執行以下指令確認所有套件安裝正確：

```bash
python -c "import discord; import aiosqlite; import httpx; import dotenv; print('✅ 所有套件安裝成功！')"
```

### 必要權限

機器人需要以下 Discord 權限：
- ✅ 讀取訊息 / 查看頻道
- ✅ 發送訊息
- ✅ 嵌入連結（Embed）
- ✅ 使用斜線指令
- ✅ 讀取訊息內容（用於 @提及觸發）
- ✅ 查看語音頻道成員

### 必要 Intents

```python
intents.members = True
intents.voice_states = True
intents.message_content = True
```

---

## 📝 注意事項

1. **語音時數**：機器人重啟時會自動恢復進行中的語音追蹤
2. **匯率資料**：使用 exchangerate-api.com 免費 API，每 5 分鐘更新一次
3. **天氣資料**：使用中央氣象署開放資料，預報快取 10 分鐘
4. **選單互動**：只有發起者可以操作選單按鈕

---

## 🤝 支援

如有問題或建議，請聯繫伺服器管理員。

---

**和風牌監視器** - 讓你的 Discord 伺服器更有趣！ 🎉
